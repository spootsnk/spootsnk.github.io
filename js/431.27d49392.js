"use strict";(self["webpackChunkgeoguess"]=self["webpackChunkgeoguess"]||[]).push([[431],{9705:function(e,t,i){var r=i(1540);function a(e){var t=[1/0,1/0,-1/0,-1/0];return r.coordEach(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}a["default"]=a,t.Z=a},8147:function(e,t,i){var r=i(611);function a(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var a=r.getCoord(e),n=r.getGeom(t),l=n.type,u=t.bbox,m=n.coordinates;if(u&&!1===s(a,u))return!1;"Polygon"===l&&(m=[m]);for(var d=!1,c=0;c<m.length&&!d;c++)if(o(a,m[c][0],i.ignoreBoundary)){var h=!1,p=1;while(p<m[c].length&&!h)o(a,m[c][p],!i.ignoreBoundary)&&(h=!0),p++;h||(d=!0)}return d}function o(e,t,i){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var a=0,o=t.length-1;a<t.length;o=a++){var s=t[a][0],n=t[a][1],l=t[o][0],u=t[o][1],m=e[1]*(s-l)+n*(l-e[0])+u*(e[0]-s)===0&&(s-e[0])*(l-e[0])<=0&&(n-e[1])*(u-e[1])<=0;if(m)return!i;var d=n>e[1]!==u>e[1]&&e[0]<(l-s)*(e[1]-n)/(u-n)+s;d&&(r=!r)}return r}function s(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}t.Z=a},4102:function(e,t){function i(e,t,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function r(e,t,i){switch(void 0===i&&(i={}),e){case"Point":return a(t).geometry;case"LineString":return l(t).geometry;case"Polygon":return s(t).geometry;case"MultiPoint":return c(t).geometry;case"MultiLineString":return d(t).geometry;case"MultiPolygon":return h(t).geometry;default:throw new Error(e+" is invalid")}}function a(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!x(e[0])||!x(e[1]))throw new Error("coordinates must contain numbers");var a={type:"Point",coordinates:e};return i(a,t,r)}function o(e,t,i){return void 0===i&&(i={}),m(e.map((function(e){return a(e,t)})),i)}function s(e,t,r){void 0===r&&(r={});for(var a=0,o=e;a<o.length;a++){var s=o[a];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var n=0;n<s[s.length-1].length;n++)if(s[s.length-1][n]!==s[0][n])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return i(l,t,r)}function n(e,t,i){return void 0===i&&(i={}),m(e.map((function(e){return s(e,t)})),i)}function l(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var a={type:"LineString",coordinates:e};return i(a,t,r)}function u(e,t,i){return void 0===i&&(i={}),m(e.map((function(e){return l(e,t)})),i)}function m(e,t){void 0===t&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function d(e,t,r){void 0===r&&(r={});var a={type:"MultiLineString",coordinates:e};return i(a,t,r)}function c(e,t,r){void 0===r&&(r={});var a={type:"MultiPoint",coordinates:e};return i(a,t,r)}function h(e,t,r){void 0===r&&(r={});var a={type:"MultiPolygon",coordinates:e};return i(a,t,r)}function p(e,t,r){void 0===r&&(r={});var a={type:"GeometryCollection",geometries:e};return i(a,t,r)}function g(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var i=Math.pow(10,t||0);return Math.round(e*i)/i}function f(e,i){void 0===i&&(i="kilometers");var r=t.factors[i];if(!r)throw new Error(i+" units is invalid");return e*r}function y(e,i){void 0===i&&(i="kilometers");var r=t.factors[i];if(!r)throw new Error(i+" units is invalid");return e/r}function v(e,t){return b(y(e,t))}function w(e){var t=e%360;return t<0&&(t+=360),t}function b(e){var t=e%(2*Math.PI);return 180*t/Math.PI}function S(e){var t=e%360;return t*Math.PI/180}function P(e,t,i){if(void 0===t&&(t="kilometers"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("length must be a positive number");return f(y(e,t),i)}function C(e,i,r){if(void 0===i&&(i="meters"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var a=t.areaFactors[i];if(!a)throw new Error("invalid original units");var o=t.areaFactors[r];if(!o)throw new Error("invalid final units");return e/a*o}function x(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function k(e){return!!e&&e.constructor===Object}function M(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!x(e))throw new Error("bbox must only contain numbers")}))}function _(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=i,t.geometry=r,t.point=a,t.points=o,t.polygon=s,t.polygons=n,t.lineString=l,t.lineStrings=u,t.featureCollection=m,t.multiLineString=d,t.multiPoint=c,t.multiPolygon=h,t.geometryCollection=p,t.round=g,t.radiansToLength=f,t.lengthToRadians=y,t.lengthToDegrees=v,t.bearingToAzimuth=w,t.radiansToDegrees=b,t.degreesToRadians=S,t.convertLength=P,t.convertArea=C,t.isNumber=x,t.isObject=k,t.validateBBox=M,t.validateId=_},611:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(4102);function a(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function o(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function s(e){if(e.length>1&&r.isNumber(e[0])&&r.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return s(e[0]);throw new Error("coordinates must only contain numbers")}function n(e,t,i){if(!t||!i)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+e.type)}function l(e,t,i){if(!e)throw new Error("No feature passed");if(!i)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+e.geometry.type)}function u(e,t,i){if(!e)throw new Error("No featureCollection passed");if(!i)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+i+", FeatureCollection required");for(var r=0,a=e.features;r<a.length;r++){var o=a[r];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!o.geometry||o.geometry.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+o.geometry.type)}}function m(e){return"Feature"===e.type?e.geometry:e}function d(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}t.getCoord=a,t.getCoords=o,t.containsNumber=s,t.geojsonType=n,t.featureOf=l,t.collectionOf=u,t.getGeom=m,t.getType=d},1540:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(4102);function a(e,t,i){if(null!==e)for(var r,o,s,n,l,u,m,d,c=0,h=0,p=e.type,g="FeatureCollection"===p,f="Feature"===p,y=g?e.features.length:1,v=0;v<y;v++){m=g?e.features[v].geometry:f?e.geometry:e,d=!!m&&"GeometryCollection"===m.type,l=d?m.geometries.length:1;for(var w=0;w<l;w++){var b=0,S=0;if(n=d?m.geometries[w]:m,null!==n){u=n.coordinates;var P=n.type;switch(c=!i||"Polygon"!==P&&"MultiPolygon"!==P?0:1,P){case null:break;case"Point":if(!1===t(u,h,v,b,S))return!1;h++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===t(u[r],h,v,b,S))return!1;h++,"MultiPoint"===P&&b++}"LineString"===P&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(o=0;o<u[r].length-c;o++){if(!1===t(u[r][o],h,v,b,S))return!1;h++}"MultiLineString"===P&&b++,"Polygon"===P&&S++}"Polygon"===P&&b++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(S=0,o=0;o<u[r].length;o++){for(s=0;s<u[r][o].length-c;s++){if(!1===t(u[r][o][s],h,v,b,S))return!1;h++}S++}b++}break;case"GeometryCollection":for(r=0;r<n.geometries.length;r++)if(!1===a(n.geometries[r],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e,t,i,r){var o=i;return a(e,(function(e,r,a,s,n){o=0===r&&void 0===i?e:t(o,e,r,a,s,n)}),r),o}function s(e,t){var i;switch(e.type){case"FeatureCollection":for(i=0;i<e.features.length;i++)if(!1===t(e.features[i].properties,i))break;break;case"Feature":t(e.properties,0);break}}function n(e,t,i){var r=i;return s(e,(function(e,a){r=0===a&&void 0===i?e:t(r,e,a)})),r}function l(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)if(!1===t(e.features[i],i))break}function u(e,t,i){var r=i;return l(e,(function(e,a){r=0===a&&void 0===i?e:t(r,e,a)})),r}function m(e){var t=[];return a(e,(function(e){t.push(e)})),t}function d(e,t){var i,r,a,o,s,n,l,u,m,d,c=0,h="FeatureCollection"===e.type,p="Feature"===e.type,g=h?e.features.length:1;for(i=0;i<g;i++){for(n=h?e.features[i].geometry:p?e.geometry:e,u=h?e.features[i].properties:p?e.properties:{},m=h?e.features[i].bbox:p?e.bbox:void 0,d=h?e.features[i].id:p?e.id:void 0,l=!!n&&"GeometryCollection"===n.type,s=l?n.geometries.length:1,a=0;a<s;a++)if(o=l?n.geometries[a]:n,null!==o)switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,c,u,m,d))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],c,u,m,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,c,u,m,d))return!1;c++}}function c(e,t,i){var r=i;return d(e,(function(e,a,o,s,n){r=0===a&&void 0===i?e:t(r,e,a,o,s,n)})),r}function h(e,t){d(e,(function(e,i,a,o,s){var n,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(r.feature(e,a,{bbox:o,id:s}),i,0)&&void 0}switch(l){case"MultiPoint":n="Point";break;case"MultiLineString":n="LineString";break;case"MultiPolygon":n="Polygon";break}for(var u=0;u<e.coordinates.length;u++){var m=e.coordinates[u],d={type:n,coordinates:m};if(!1===t(r.feature(d,a),i,u))return!1}}))}function p(e,t,i){var r=i;return h(e,(function(e,a,o){r=0===a&&0===o&&void 0===i?e:t(r,e,a,o)})),r}function g(e,t){h(e,(function(e,i,o){var s=0;if(e.geometry){var n=e.geometry.type;if("Point"!==n&&"MultiPoint"!==n){var l,u=0,m=0,d=0;return!1!==a(e,(function(a,n,c,h,p){if(void 0===l||i>u||h>m||p>d)return l=a,u=i,m=h,d=p,void(s=0);var g=r.lineString([l,a],e.properties);if(!1===t(g,i,o,p,s))return!1;s++,l=a}))&&void 0}}}))}function f(e,t,i){var r=i,a=!1;return g(e,(function(e,o,s,n,l){r=!1===a&&void 0===i?e:t(r,e,o,s,n,l),a=!0})),r}function y(e,t){if(!e)throw new Error("geojson is required");h(e,(function(e,i,a){if(null!==e.geometry){var o=e.geometry.type,s=e.geometry.coordinates;switch(o){case"LineString":if(!1===t(e,i,a,0,0))return!1;break;case"Polygon":for(var n=0;n<s.length;n++)if(!1===t(r.lineString(s[n],e.properties),i,a,n))return!1;break}}}))}function v(e,t,i){var r=i;return y(e,(function(e,a,o,s){r=0===a&&void 0===i?e:t(r,e,a,o,s)})),r}function w(e,t){if(t=t||{},!r.isObject(t))throw new Error("options is invalid");var i,a=t.featureIndex||0,o=t.multiFeatureIndex||0,s=t.geometryIndex||0,n=t.segmentIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":a<0&&(a=e.features.length+a),l=l||e.features[a].properties,i=e.features[a].geometry;break;case"Feature":l=l||e.properties,i=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=e;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var u=i.coordinates;switch(i.type){case"Point":case"MultiPoint":return null;case"LineString":return n<0&&(n=u.length+n-1),r.lineString([u[n],u[n+1]],l,t);case"Polygon":return s<0&&(s=u.length+s),n<0&&(n=u[s].length+n-1),r.lineString([u[s][n],u[s][n+1]],l,t);case"MultiLineString":return o<0&&(o=u.length+o),n<0&&(n=u[o].length+n-1),r.lineString([u[o][n],u[o][n+1]],l,t);case"MultiPolygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s),n<0&&(n=u[o][s].length-n-1),r.lineString([u[o][s][n],u[o][s][n+1]],l,t)}throw new Error("geojson is invalid")}function b(e,t){if(t=t||{},!r.isObject(t))throw new Error("options is invalid");var i,a=t.featureIndex||0,o=t.multiFeatureIndex||0,s=t.geometryIndex||0,n=t.coordIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":a<0&&(a=e.features.length+a),l=l||e.features[a].properties,i=e.features[a].geometry;break;case"Feature":l=l||e.properties,i=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=e;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var u=i.coordinates;switch(i.type){case"Point":return r.point(u,l,t);case"MultiPoint":return o<0&&(o=u.length+o),r.point(u[o],l,t);case"LineString":return n<0&&(n=u.length+n),r.point(u[n],l,t);case"Polygon":return s<0&&(s=u.length+s),n<0&&(n=u[s].length+n),r.point(u[s][n],l,t);case"MultiLineString":return o<0&&(o=u.length+o),n<0&&(n=u[o].length+n),r.point(u[o][n],l,t);case"MultiPolygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s),n<0&&(n=u[o][s].length-n),r.point(u[o][s][n],l,t)}throw new Error("geojson is invalid")}t.coordAll=m,t.coordEach=a,t.coordReduce=o,t.featureEach=l,t.featureReduce=u,t.findPoint=b,t.findSegment=w,t.flattenEach=h,t.flattenReduce=p,t.geomEach=d,t.geomReduce=c,t.lineEach=y,t.lineReduce=v,t.propEach=s,t.propReduce=n,t.segmentEach=g,t.segmentReduce=f},6295:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(4102);function a(e){return Array.isArray(e)?c(e):e&&e.bbox?c(e.bbox):[m(),d()]}function o(e,t){void 0===t&&(t={}),void 0!==e&&null!==e||(e=1);for(var i=[],o=0;o<e;o++)i.push(r.point(a(t.bbox)));return r.featureCollection(i)}function s(e,t){void 0===t&&(t={}),void 0!==e&&null!==e||(e=1),r.isNumber(t.num_vertices)&&void 0!==t.num_vertices||(t.num_vertices=10),r.isNumber(t.max_radial_length)&&void 0!==t.max_radial_length||(t.max_radial_length=10);for(var i=[],o=function(e){var o=[],s=Array.apply(null,new Array(t.num_vertices+1)).map(Math.random);s.forEach((function(e,t,i){i[t]=t>0?e+i[t-1]:e})),s.forEach((function(e){e=2*e*Math.PI/s[s.length-1];var i=Math.random();o.push([i*(t.max_radial_length||10)*Math.sin(e),i*(t.max_radial_length||10)*Math.cos(e)])})),o[o.length-1]=o[0],o=o.map(l(a(t.bbox))),i.push(r.polygon([o]))},s=0;s<e;s++)o(s);return r.featureCollection(i)}function n(e,t){if(void 0===t&&(t={}),t=t||{},!r.isObject(t))throw new Error("options is invalid");var i=t.bbox,o=t.num_vertices,s=t.max_length,n=t.max_rotation;void 0!==e&&null!==e||(e=1),(!r.isNumber(o)||void 0===o||o<2)&&(o=10),r.isNumber(s)&&void 0!==s||(s=1e-4),r.isNumber(n)&&void 0!==n||(n=Math.PI/8);for(var l=[],u=0;u<e;u++){for(var m=a(i),d=[m],c=0;c<o-1;c++){var h=0===c?2*Math.random()*Math.PI:Math.tan((d[c][1]-d[c-1][1])/(d[c][0]-d[c-1][0])),p=h+(Math.random()-.5)*n*2,g=Math.random()*s;d.push([d[c][0]+g*Math.cos(p),d[c][1]+g*Math.sin(p)])}l.push(r.lineString(d))}return r.featureCollection(l)}function l(e){return function(t){return[t[0]+e[0],t[1]+e[1]]}}function u(){return Math.random()-.5}function m(){return 360*u()}function d(){return 180*u()}function c(e){return[Math.random()*(e[2]-e[0])+e[0],Math.random()*(e[3]-e[1])+e[1]]}t.randomPosition=a,t.randomPoint=o,t.randomPolygon=s,t.randomLineString=n},3043:function(e,t,i){const r=i(9705).Z,a=i(6295),o=i(8147).Z;function s(e){if(!e||!e.type||"Feature"!==e.type||-1===["Polygon","MultiPolygon"].indexOf(e.geometry.type))throw new Error("param polygon must be a Feature<(Polygon|MultiPolygon)>");let t;const i=r(e);do{t=a.randomPosition(i)}while(!o(t,e));return t}e.exports=s},6431:function(e,t,i){i.r(t),i.d(t,{default:function(){return Le}});var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"game-page"}},[i("div",{attrs:{id:"street-view-container"}},[i("HeaderGame",{ref:"header",attrs:{distance:e.scoreHeader,points:e.pointsHeader,round:e.round,"room-name":e.roomName,"nb-round":e.nbRound,"remaining-time":e.remainingTime,mode:e.mode}}),i("div",{attrs:{id:"game-interface"}},[i("v-overlay",{attrs:{value:!e.isReady&&e.multiplayer,opacity:"1"}}),i("div",{ref:"streetView",attrs:{id:"street-view"}}),i("div",{attrs:{id:"game-interface__overlay"}},[i("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,a=t.attrs;return[i("v-btn",e._g(e._b({staticClass:"resetBtn",attrs:{rounded:"",dark:"",fab:""},on:{click:e.resetLocation}},"v-btn",a,!1),r),[i("v-icon",[e._v("mdi-crosshairs-gps")])],1)]}}])},[i("span",[e._v(e._s(e.$t("Maps.reset")))])]),i("Maps",{ref:"mapContainer",attrs:{"random-lat-lng":e.randomLatLng,"random-feature-properties":e.randomFeatureProperties,"room-name":e.roomName,"player-number":e.playerNumber,"player-name":e.playerName,"is-ready":e.isReady,round:e.round,score:e.score,points:e.points,difficulty:e.difficultyData,"time-limitation":e.timeLimitation,bbox:e.bbox,mode:e.mode,area:e.area,"time-attack":e.timeAttack,"nb-round":e.nbRound,countdown:e.countdown,"score-mode":e.scoreMode,areasGeoJsonUrl:e.areaParams&&e.areaParams.data.urlArea,pathKey:e.areaParams?e.areaParams.data.pathKey:"iso_a2",mapDetails:e.mapDetails},on:{resetLocation:e.resetLocation,calculateDistance:e.updateScore,showResult:e.showResult,goToNextRound:e.goToNextRound,finishGame:e.finishGame}})],1)],1)],1),i("v-overlay",{attrs:{value:e.overlay,opacity:"0.8","z-index":"1"}}),i("DialogMessage",{attrs:{"dialog-message":e.dialogMessage,"dialog-title":e.dialogTitle,"dialog-text":e.dialogText}}),i("div",{staticClass:"alert-container"},[e.isVisibleDialog?i("v-alert",{staticClass:"warning-alert",attrs:{type:"warning",dismissible:""}},[i("b",[e._v(e._s(e.$t("StreetView.nearby.title")))]),e._v(" : "+e._s(e.$t("StreetView.nearby.message"))+" ")]):e._e(),i("v-alert",{attrs:{id:"warningCountdown",type:"info",dismissible:"",transition:"slide-x-transition",prominent:"",icon:"mdi-clock-fast"},model:{value:e.isVisibleCountdownAlert,callback:function(t){e.isVisibleCountdownAlert=t},expression:"isVisibleCountdownAlert"}},[e._v(" "+e._s(e.$tc("StreetView.countdownAlert",e.remainingTime))+" "),i("v-progress-linear",{attrs:{active:e.isVisibleCountdownAlert,color:"white",absolute:"",bottom:""},model:{value:e.countdownPercentage,callback:function(t){e.countdownPercentage=t},expression:"countdownPercentage"}})],1)],1)],1)},a=[],o=(i(6699),i(5503)),s=(i(4642),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-app-bar",{staticClass:"header-game",attrs:{color:"grey darken-4"}},[null!=e.remainingTime&&e.remainingTime>0?i("div",[i("span",{attrs:{id:"countdown-text"}},[e._v(e._s(e.countdownText))])]):i("div",[i("span",{attrs:{id:"countdown-text"}},[e._v(e._s(e.timerText))])]),e.roomName&&!e.streamerMode?i("div",{staticClass:"round-score-container room-name"},[i("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.room"))+" : ")]),i("span",{staticClass:"main-text"},[e._v(" "+e._s(e.roomName)+" ")])]):e._e(),i("div",{staticClass:"flex-grow-1"}),i("div",{staticClass:"round-score-container"},[i("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.round"))+": ")]),i("span",{staticClass:"main-text",attrs:{id:"roundLabel"}},[e._v(" "+e._s(e.round)+" / "+e._s(e.nbRound)+" ")])]),e.isDistanceVisible?i("div",{staticClass:"round-score-container"},[i("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.distance"))+": ")]),i("span",{staticClass:"main-text"},[e._v(e._s(e.$t("HeaderGame.kmaway",{value:new Intl.NumberFormat(e.$i18n.locale).format(e.distance/1e3)})))])]):e._e(),i("div",{staticClass:"round-points-container"},[i("span",{staticClass:"sub-text"},[e._v(e._s(e.$t("HeaderGame.score"))+": ")]),i("span",{staticClass:"main-text"},[e._v(e._s(e.points))])])])],1)}),n=[],l=i(6927),u=i(8200),m=i(629),d={props:["distance","points","round","remainingTime","roomName","nbRound"],data(){return{startedAt:null,timerText:"",intervalFunction:null}},watch:{round:function(){this.startTimer()}},computed:{...(0,m.rn)({streamerMode:e=>e.homeStore.streamerMode}),countdownText(){return(0,l.Xw)(this.remainingTime)},isDistanceVisible(){return this.mode!==u.wz.COUNTRY}},methods:{startTimer(){0==this.remainingTime&&(this.startedAt=new Date,this.intervalFunction=setInterval((()=>{this.timerText=(0,l.Xw)(Math.round((Date.now()-this.startedAt)/1e3))}),1e3))},stopTimer(){this.intervalFunction&&clearInterval(this.intervalFunction)}}},c=d,h=i(3736),p=i(3453),g=i.n(p),f=i(2881),y=(0,h.Z)(c,s,n,!1,null,"32189a00",null),v=y.exports;g()(y,{VAppBar:f.Z});var w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._g({class:[e.$viewport.width>=450&&(e.activeMap||e.pinActive)||e.isMakeGuessButtonClicked||e.isNextButtonVisible?"container-map--active":"",e.printMapFull?"container-map--full":"","container-map--size-"+e.size],attrs:{id:"container-map"}},e.$viewport.width>=450?{mouseover:function(){e.activeMap=!0},mouseleave:function(){e.activeMap=!1}}:{}),[i("div",{staticClass:"container-map_details"},[e.printMapFull?i("DetailsMap",{attrs:{properties:e.randomFeatureProperties}}):e._e()],1),i("div",{staticClass:"container-map_controls"},[i("div",{staticClass:"container-map_btns"},[i("v-btn",{attrs:{fab:"","x-small":""},on:{click:e.showNotepad}},[i("v-icon",{attrs:{dark:""}},[e._v(" mdi-file-document-edit ")])],1),i("v-btn",{attrs:{id:"btnDown",fab:"","x-small":"",disabled:e.size<2},on:{click:function(t){e.size--}}},[i("v-icon",{attrs:{dark:""}},[e._v(" mdi-arrow-bottom-left ")])],1),i("v-btn",{attrs:{id:"btnUp",fab:"","x-small":"",disabled:e.size>3},on:{click:function(t){e.size++}}},[i("v-icon",{attrs:{dark:""}},[e._v(" mdi-arrow-top-right ")])],1),i("v-btn",{attrs:{id:"btnPin",fab:"","x-small":""},on:{click:function(t){e.pinActive=!e.pinActive}}},[i("v-icon",{attrs:{dark:""}},[e._v(" mdi-pin"+e._s(e.pinActive?"-off":"")+" ")])],1)],1)]),e.$viewport.width<450&&!e.isGuessButtonClicked&&e.isMakeGuessButtonClicked?i("v-btn",{attrs:{id:"hide-map-button",fab:"","x-small":"",color:"red"},on:{click:e.hideMap}},[i("v-icon",{attrs:{color:"white"}},[e._v(" mdi-close ")])],1):e._e(),"classic"===this.mode?i("Map",{ref:"map",attrs:{id:"map",bbox:e.bbox},on:{setSeletedPos:e.setSeletedPos}}):e._e(),"classic"!==this.mode?i("MapAreas",{ref:"map",attrs:{id:"map",area:e.area,areasGeoJsonUrl:e.areasGeoJsonUrl,pathKey:e.pathKey,bbox:e.bbox,showFlag:"country"===this.mode},on:{setSeletedPos:e.setSeletedPos}}):e._e(),e.printMapFull?e._e():i("textarea",{directives:[{name:"show",rawName:"v-show",value:e.isNotepadVisible,expression:"isNotepadVisible"}],ref:"refNotepad",staticClass:"container-map_notepad",attrs:{spellcheck:"false"}}),e._v(" "),e.isNextButtonVisible||e.isSummaryButtonVisible||!(e.$viewport.width>450||e.isMakeGuessButtonClicked)?e._e():i("button",{attrs:{id:"guess-button",disabled:null==e.randomLatLng||null==e.selectedPos||e.isGuessButtonClicked||!!this.room&&!e.isReady},on:{click:e.selectLocation}},[e._v(" "+e._s(e.$t("Maps.guess"))+" ")]),e.isNextButtonVisible?i("button",{style:{backgroundColor:e.isNextButtonEnabled?"#F44336":"#B71C1C"},attrs:{id:"next-button",disabled:!e.isNextButtonEnabled},on:{click:function(t){return e.goToNextRound(!1)}}},[e._v(" "+e._s(e.$t("Maps.nextRound"))+" ")]):e._e(),e.isSummaryButtonVisible?i("button",{attrs:{id:"summary-button"},on:{click:function(t){e.dialogSummary=!0}}},[e._v(" "+e._s(e.$t("Maps.viewSummary"))+" ")]):e._e(),e.$viewport.width<450&&!e.isGuessButtonClicked&&!e.isMakeGuessButtonClicked&&!e.isNextButtonVisible?i("button",{staticClass:"primary",attrs:{id:"make-guess-button"},on:{click:e.showMap}},[e._v(" "+e._s(e.$t("Maps.makeGuess"))+" ")]):e._e(),i("DialogSummary",{attrs:{"dialog-summary":e.dialogSummary,"summary-texts":e.summaryTexts,score:e.score,"player-name":e.playerName,points:e.points,game:e.game,multiplayer:!!e.room,mapDetails:e.mapDetails,"nb-round":e.nbRound},on:{finishGame:e.finishGame,playAgain:function(t){return e.goToNextRound(!0)}}})],1)},b=[],S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{value:e.dialogSummary,"max-width":"720",persistent:"",fullscreen:e.$viewport.width<450}},[i("v-card",{attrs:{color:"#061422"}},[i("v-card-text",{attrs:{id:"card-text"}},[e.multiplayer?e._e():i("v-row",{attrs:{justify:"center"}},[i("p",{attrs:{id:"summary-text"},domProps:{innerHTML:e._s(e.$t("DialogSummary.summaryMsgSinglePoints",{points:e.points})+(e.showDistance?e.$t("DialogSummary.summaryMsgSingleDistance",{distance:e.score/1e3}):""))}})]),e._l(e.summaryTexts,(function(t,r){return i("v-row",{key:r,staticClass:"mt-3",attrs:{justify:"center"}},[i("span",{attrs:{id:"summary-text"}},[0==r||1==r||2==r?i("v-icon",{attrs:{color:0==r?"#CCAC00":1==r?"#C0C0C0":"#CC8E34"}},[e._v("mdi-crown")]):e._e(),i("span",{domProps:{innerHTML:e._s(e.$t("DialogSummary.summaryMsgMultiPoints",{playerName:t.playerName,points:t.finalPoints})+(e.showDistance?e.$t("DialogSummary.summaryMsgMultiDistance",{distance:t.finalScore/1e3}):""))}})],1)])})),i("v-row",{staticClass:"mt-8",attrs:{justify:"center"}},[i("v-btn",{staticClass:"mt-8",attrs:{id:"play-again-button",dark:"",color:"#43B581"},on:{click:function(t){return e.$emit("finishGame")}}},[e._v(" "+e._s(e.$t("DialogSummary.viewDetails"))+" ")]),e.multiplayer?e._e():i("v-btn",{staticClass:"mt-8",attrs:{id:"exit-button",dark:"",color:"#f44336"},on:{click:function(t){return e.$emit("playAgain")}}},[e._v(" "+e._s(e.$t("Maps.playAgain"))+" ")])],1)],2)],1)],1)},P=[],C={props:["dialogSummary","summaryTexts","playerName","score","points","multiplayer","game","mode","mapDetails","nbRound"],computed:{showDistance(){return this.mode===u.wz.CLASSIC}},watch:{dialogSummary:function(e){1==e&&this.updateRecord()}},methods:{updateRecord(){let e=localStorage.getItem("history");e=null==e?[]:JSON.parse(e),e.push({...this.game,score:this.score,points:this.points,rank:this.multiplayer?this.summaryTexts.findIndex((e=>e.playerName===this.playerName))+1:void 0,nbRound:this.nbRound,mapDetails:this.mapDetails}),localStorage.setItem("history",JSON.stringify(e))},finishGame(){this.$emit("finishGame")}}},x=C,k=i(4865),M=i(4266),_=i(116),L=i(1079),N=i(563),V=i(503),R=(0,h.Z)(x,S,P,!1,null,"200a3bd4",null),T=R.exports;g()(R,{VBtn:k.Z,VCard:M.Z,VCardText:_.ZB,VDialog:L.Z,VIcon:N.Z,VRow:V.Z});var E=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.properties&&"object"===typeof e.properties&&(e.properties.title||e.properties.description)?i("div",{staticClass:"details-map_container"},[i("h2",[e._v(" "+e._s(e.properties.title)+" ")]),i("p",[e._v(" "+e._s(e.properties.description)+" ")]),e.properties.link&&e.validURL(e.properties.link)?i("a",{staticClass:"details-map_link",attrs:{href:e.properties.link,target:"_blank"}},[i("v-icon",{attrs:{color:"darkGreen"}},[e._v("mdi-alert-circle")]),e._v(" "+e._s(e.$t("DetailsMap.moreInfo")))],1):e._e()]):e._e()},$=[],A={name:"DetailsMap",props:["properties"],methods:{validURL(e){return(0,l.b3)(e)}}},G=A,F=(0,h.Z)(G,E,$,!1,null,"4d0af0f4",null),D=F.exports;g()(F,{VIcon:N.Z});var B=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"map"}},[i("GmapMap",{ref:"mapRef",attrs:{id:"mapClassic",center:{lat:37.86926,lng:-122.254811},zoom:1,"map-type-id":"roadmap",options:{fullscreenControl:!1,mapTypeControl:!1,streetViewControl:!1,draggableCursor:"crosshair",clickableIcons:!1,styles:e.$vuetify.theme.dark?e.$vuetify.theme.themes.dark.gmap:e.$vuetify.theme.themes.light.gmap}}})],1)},O=[];const I={props:["bbox"],watch:{bbox(){this.centerOnBbox()}},methods:{centerOnBbox(){this.map&&(this.bbox?this.map.fitBounds({east:this.bbox[2],north:this.bbox[3],south:this.bbox[1],west:this.bbox[0]}):(this.map.setZoom(0),this.map.setCenter({lat:0,lng:0})))},drawPolyline(){},removePolylines(){}}};var Z=I,z={name:"Map",mixins:[Z],data(){return{map:null,marker:[],markers:[],polylines:[],strokeColors:u.G8}},async mounted(){await this.$gmapApiPromiseLazy(),this.$refs.mapRef.$mapPromise.then((e=>{this.map=e,this.centerOnBbox()}))},methods:{putMarker(e,t,i){let r={};t&&(r={icon:{url:window.location.origin+"/img/icons/favicon-16x16.png",anchor:new google.maps.Point(8,8)}}),i&&(r={label:i});const a=new google.maps.Marker({...r,position:e,map:this.map});this.markers.push(a)},removeMarkers(){for(var e=0;e<this.markers.length;e++)this.markers[e].setMap(null);this.markers=[]},setInfoWindow(e,t,i,r=!1){let a="";null!==e&&(a+="<b>"+e+"</b> : <br/>"),a+=t<1e3?"<b>"+this.$t("Maps.infoWindow.Distance")+": </b>"+new Intl.NumberFormat(this.$i18n.locale,{style:"unit",unit:"meter"}).format(t):"<b>"+this.$t("Maps.infoWindow.Distance")+": </b>"+new Intl.NumberFormat(this.$i18n.locale,{style:"unit",unit:"kilometer"}).format(t/1e3),a+="<br/><b>"+this.$t("Maps.infoWindow.Points")+": </b>"+i;const o=new google.maps.InfoWindow({content:a});o.open(this.map,this.markers[e||r?this.markers.length-1:0])},drawPolyline(e,t=0,i){const r={path:"M 0,-1 0,1",strokeOpacity:1,scale:2},a=new google.maps.Polyline({path:[e,i],strokeOpacity:0,strokeColor:this.strokeColors[t%this.strokeColors.length],icons:[{icon:r,offset:"0",repeat:"10px"}]});a.setMap(this.map),this.polylines.push(a)},removePolylines(){for(let e=0;e<this.polylines.length;e++)this.polylines[e].setMap(null)},startNextRound(){this.$refs.mapRef.$mapPromise.then((()=>{this.map.addListener("click",(e=>{this.removeMarkers(),this.putMarker(e.latLng),this.$emit("setSeletedPos",e.latLng)})),this.centerOnBbox()}))},removeListener(){google.maps.event.clearListeners(this.map,"click")},fitBounds(){const e=new google.maps.LatLngBounds;for(let t=0;t<this.markers.length;t++)this.markers[t].getVisible()&&e.extend(this.markers[t].getPosition());this.map.fitBounds(e)}}},U=z,J=(0,h.Z)(U,B,O,!1,null,"4395e0c1",null),j=J.exports,q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"map-areas",attrs:{id:"map"}},[i("div",{staticClass:"map-content"},[e.polygonSelect||e.areaName?i("div",{staticClass:"map-label",attrs:{title:e.areaName}},[e.showFlag?i("FlagIcon",{attrs:{size:"big",rounded:"","iso-name":e.areaRandom||e.areaNameSelect}}):e._e(),i("span",{staticClass:"map-label__country-name",class:{beige:!e.areaRandom,green:!!e.areaRandom,"white--text":!!e.areaRandom,large:!e.showFlag}},[e._v(" "+e._s(e.areaName)+" ")])],1):e._e(),i("GmapMap",{ref:"mapRef",attrs:{id:"mapAreas",center:{lat:37.86926,lng:-122.254811},zoom:1,"map-type-id":"roadmap",options:{fullscreenControl:!1,mapTypeControl:!1,streetViewControl:!1,draggableCursor:"crosshair",clickableIcons:!1,styles:e.$vuetify.theme.dark?e.$vuetify.theme.themes.dark.gmap:e.$vuetify.theme.themes.light.gmap}}})],1),e.infoWindowDatas.length>0?i("div",{staticClass:"result-panel"},e._l(e.infoWindowDatas,(function(t){return i("div",{key:t.playerName,staticClass:"result-panel__item",class:{flag:e.showFlag}},[e.showFlag?i("FlagIcon",{attrs:{"iso-name":t.area}}):e._e(),i("b",[e._v(e._s(t.playerName))]),e.showFlag?e._e():i("span",[e._v(e._s(t.area))])],1)})),0):e._e()])},H=[],K=i(7061),W={mixins:[Z],components:{FlagIcon:K.Z},props:{area:{type:String},areasGeoJsonUrl:String,pathKey:{type:String,default:"iso_a2"},showFlag:Boolean},data(){return{map:null,polygonSelect:null,areas:{},markers:[],allowSelect:!0,areaRandom:null,randomPos:null,infoWindowDatas:[]}},computed:{...(0,m.Se)(["areasJson"]),areaName(){return this.showFlag&&(this.areaRandom||this.polygonSelect)?this.$countryNameLocale(this.areaRandom||this.areaNameSelect):this.areaRandom||this.areaNameSelect},areaNameSelect(){return this.polygonSelect?this.polygonSelect.getFeatureById("feature").getProperty(this.pathKey):void 0}},async mounted(){await this.loadAreas(this.areasGeoJsonUrl),await this.$gmapApiPromiseLazy(),this.$refs.mapRef.$mapPromise.then((e=>{this.map=e,this.areasJson.features.forEach((e=>{if(Array.isArray(e.geometry.coordinates)){const t=new google.maps.Data({style:{strokeOpacity:0,fillOpacity:0,strokeWeight:2}});e.id="feature",t.addGeoJson(e),t.setMap(this.map),t.addListener("click",(()=>{this.allowSelect&&(this.polygonSelect&&this.polygonSelect.setStyle({strokeOpacity:0,fillOpacity:0}),Object.is(t,this.polygonSelect)?(this.polygonSelect=null,this.$emit("setSeletedPos",null)):(t.setStyle({strokeOpacity:.8,fillOpacity:.3,strokeColor:"#1E3A8A",fillColor:"#1D4ED8"}),this.polygonSelect=t,this.$emit("setSeletedPos",t.getFeatureById("feature").getProperty(this.pathKey))))})),this.areas[e.properties[this.pathKey]]=t}})),this.centerOnBbox()}))},methods:{...(0,m.nv)(["loadAreas"]),putMarker(e,t,i){const r=t?i||this.area:e;t&&(this.areaRandom=this.area,this.randomPos=new google.maps.Marker({position:e,map:this.map})),this.areas[r]&&(this.areas[r].setStyle({fillOpacity:.3,strokeOpacity:.8,fillColor:t?"#52DA42":"#FF4081",strokeColor:t?"#16A910":"#FF4081"}),this.markers.push(r))},removeMarkers(){this.markers.forEach((e=>{this.areas[e].setStyle({strokeOpacity:0,fillOpacity:0})})),this.polygonSelect&&this.polygonSelect.setStyle({strokeOpacity:0,fillOpacity:0}),this.randomPos&&(this.randomPos.setMap(null),this.randomPos=null),this.markers=[],this.infoWindowDatas=[]},setInfoWindow(e,t,i,r,a){e&&this.infoWindowDatas.push({playerName:e,area:a})},startNextRound(){this.polygonSelect&&this.polygonSelect.setStyle({strokeOpacity:0,fillOpacity:0}),this.polygonSelect=null,this.areaRandom=null,this.allowSelect=!0,this.centerOnBbox()},removeListener(){this.allowSelect=!1},fitBounds(){this.bbox?this.centerOnBbox():this.map.setZoom(2)}}},Y=W,X=(0,h.Z)(Y,q,H,!1,null,"30884500",null),Q=X.exports;function ee(e,t,i,r){switch(r){case u.se.TIME:return Math.round(te(e,t)*Math.exp(-i/6e6));default:return te(e,t)}}function te(e,t){if(e<50)return 5e3;{const i=Math.round(5e3*Math.exp(-e/1e3/t));return i>5e3?5e3:i<0?0:i}}var ie={components:{DialogSummary:T,DetailsMap:D,Map:j,MapAreas:Q},props:["randomLatLng","randomFeatureProperties","roomName","playerNumber","playerName","isReady","round","score","points","timeLimitation","difficulty","bbox","mode","area","timeAttack","nbRound","countdown","scoreMode","areasGeoJsonUrl","pathKey","mapDetails"],data(){return{summaryTexts:[],room:null,selectedPos:null,distance:null,point:null,isGuessButtonClicked:!1,isMakeGuessButtonClicked:!1,isSelected:!1,isNextStreetViewReady:!1,isNextButtonVisible:!1,isSummaryButtonVisible:!1,dialogSummary:!1,activeMap:!1,size:2,isNotepadVisible:!1,pinActive:"true"===localStorage.getItem("pinActive"),printMapFull:!1,countdownStarted:!1,game:{multiplayer:!!this.roomName,date:new Date,rounds:[]},startTime:null}},computed:{isNextButtonEnabled(){return 1==this.playerNumber||!this.room||!!this.isNextStreetViewReady}},watch:{pinActive(){localStorage.setItem("pinActive",this.pinActive)}},async mounted(){await this.$gmapApiPromiseLazy(),this.game.timeLimitation=this.timeLimitation,this.game.difficulty=this.difficulty,this.game.mode=this.mode,this.game.timeAttack=this.timeAttack,this.game.playerName=this.playerName;let e=0;this.roomName&&(this.room=o.Z.database().ref(this.roomName),this.room.on("value",(t=>{if(t.hasChild("active")){if(e=t.child("size").val(),1===e?this.room.onDisconnect().remove():this.room.onDisconnect().update({size:e-1}),this.timeAttack&&0===this.countdown&&t.child("guess").numChildren()>=1&&t.child("guess").forEach((e=>e.child("area").val()===this.area))||t.child("guess").numChildren()===e){this.game.timeLimitation=this.timeLimitation,this.isNextStreetViewReady=!1,this.$emit("showResult");let e=0,i={};t.child("guess").forEach((r=>{let a;if(this.mode===u.wz.CLASSIC){const e=r.child("latitude").val(),t=r.child("longitude").val();a=new google.maps.LatLng({lat:e,lng:t})}else a=r.child("area").val();const o=t.child("playerName").child(r.key).val(),s=t.child("round"+this.round+"/"+r.key).exportVal(),{points:n,distance:l}=s;i[o]={...s,guess:a},this.$refs.map.drawPolyline(a,e,this.randomLatLng),this.$refs.map.putMarker(a,!1,o&&o.length>0?o[0].toUpperCase():""),this.$refs.map.setInfoWindow(o,l,n,!1,a),e++})),this.$refs.map.fitBounds(),this.game.rounds.push({position:{...this.randomLatLng.toJSON(),area:this.area},players:i}),this.$refs.map.putMarker(this.randomLatLng,!0),this.printMapFull=!0,this.room.child("guess").remove(),this.round>=this.nbRound?(t.child("finalPoints").forEach((e=>{const i=t.child("playerName").child(e.key).val(),r=t.child("finalScore").child(e.key).val(),a=e.val();this.summaryTexts.push({playerName:i,finalScore:r,finalPoints:a})})),this.summaryTexts.sort(((e,t)=>parseInt(t.finalPoints)-parseInt(e.finalPoints))),this.isSummaryButtonVisible=!0):this.isNextButtonVisible=!0}t.child("streetView").numChildren()==this.round+1&&(this.isNextStreetViewReady=!0),!this.countdownStarted&&!this.printMapFull&&this.countdown>0&&t.child("guess").numChildren()>=1&&(this.$parent.initTimer(this.countdown,!0),this.countdownStarted=!0)}})))},methods:{setSeletedPos(e){this.selectedPos=e},showMap(){this.isMakeGuessButtonClicked=!0},hideMap(){this.isMakeGuessButtonClicked=!1},showNotepad(){this.isNotepadVisible=!this.isNotepadVisible,this.isNotepadVisible&&setTimeout((()=>{this.$refs.refNotepad.focus()}))},selectLocation(){this.calculateDistance(),this.room?this.room.child("guess/player"+this.playerNumber).set((0,l.nV)(this.selectedPos,this.mode)):(this.$refs.map.putMarker(this.randomLatLng,!0),this.$refs.map.drawPolyline(this.selectedPos,1,this.randomLatLng),this.$refs.map.setInfoWindow(null,this.distance,this.point,!1,this.setSeletedPos),this.printMapFull=!0,this.$refs.map.fitBounds(),this.round>=this.nbRound?this.isSummaryButtonVisible=!0:this.isNextButtonVisible=!0,this.$emit("showResult")),this.$refs.map.removeListener(),this.isGuessButtonClicked=!0,this.isSelected=!0,this.isNextStreetViewReady=!1},selectRandomLocation(e){null===this.selectedPos&&(this.selectedPos=e,this.$refs.map.removeMarkers(),this.$refs.map.putMarker(this.selectedPos)),this.selectLocation()},resetLocation(){this.$emit("resetLocation")},calculateDistance(){const e=new Date-this.startTime;[u.wz.COUNTRY,u.wz.CUSTOM_AREA].includes(this.mode)?(this.point=+(this.area===this.selectedPos),this.distance=null):(this.distance=Math.floor(google.maps.geometry.spherical.computeDistanceBetween(this.randomLatLng,this.selectedPos)),this.point=ee(this.distance,this.difficulty,e,this.scoreMode)),this.room?this.room.child("round"+this.round+"/player"+this.playerNumber).set({...(0,l.nV)(this.selectedPos,this.mode),distance:this.distance,points:this.point,timePassed:e}):this.game.rounds.push({guess:this.selectedPos,area:this.area,position:this.randomLatLng,distance:this.distance,points:this.point,timePassed:e}),this.$emit("calculateDistance",this.distance,this.point)},startNextRound(){this.$refs.map.startNextRound(),this.startTime=new Date},goToNextRound(e=!1){e&&(this.dialogSummary=!1,this.isSummaryButtonVisible=!1),this.selectedPos=null,this.isGuessButtonClicked=!1,this.isSelected=!1,this.isNextButtonVisible=!1,this.countdownStarted=!1,this.isNotepadVisible=!1,this.$viewport.width<450&&this.hideMap(),this.printMapFull=!1,this.$refs.map.removeMarkers(),this.$refs.map.removePolylines(),this.$refs.map.centerOnBbox(),this.$emit("goToNextRound",e)},finishGame(){this.dialogSummary=!1,this.room&&this.room.child("isGameDone/player"+this.playerNumber).set(!0),this.$emit("finishGame")}}},re=ie,ae=(0,h.Z)(re,w,b,!1,null,"7eafb31a",null),oe=ae.exports;g()(ae,{VBtn:k.Z,VIcon:N.Z});var se=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{value:e.dialogMessage,"max-width":"600",persistent:"",fullscreen:e.$viewport.width<450}},[i("v-card",{attrs:{color:"#061422"}},[i("v-card-title",[i("span",{staticClass:"dialog-message__title",attrs:{id:"card-title"}},[e._v(e._s(e.dialogTitle))])]),i("v-card-text",[i("v-container",[i("span",[e._v(e._s(e.dialogText))])])],1)],1)],1)},ne=[],le={props:["dialogMessage","dialogTitle","dialogText"]},ue=le,me=i(7986),de=(0,h.Z)(ue,se,ne,!1,null,"d9759994",null),ce=de.exports;g()(de,{VCard:M.Z,VCardText:_.ZB,VCardTitle:_.EB,VContainer:me.Z,VDialog:L.Z});i(1703);var he=i(7592),pe=i(2037),ge=i(1449),fe=i(3043),ye=i.n(fe);class ve{constructor(e,t,i,r){this.settingsPanorama=e,this.settingsGame=t,this.placeGeoJson=i,this.roundsPredefined=r,this.service=new google.maps.StreetViewService,this.alreadyVisited=[]}async getStreetView(e,t=0){let i,r,a;if(this.roundsPredefined){i=50;const t=this.roundsPredefined[e-1];r=new google.maps.LatLng(t[0],t[1])}else{let e;do{e=this.getRandomLatLng()}while(this.alreadyVisited.includes(e.position.toString()));this.alreadyVisited.push(e.position.toString()),i=e.radius,r=e.position,a=e.properties}return new Promise((o=>{this.service.getPanorama({location:r,preference:"nearest",radius:i,source:this.settingsPanorama.allPanorama?"default":"outdoor"},(async(i,r)=>{r===google.maps.StreetViewStatus.OK&&i&&i.location&&this._checkStreetView(i)?o(await this._getResponseStreetViewService(e,i,t,a)):o(await this.getStreetView(e))}))}))}async _getResponseStreetViewService(e,t,i,r){let a,o=!1;if(null!=this.placeGeoJson&&(a=(0,l.Rw)(ge.xm([t.location.latLng.lng(),t.location.latLng.lat()]),this.placeGeoJson)),!1===a&&i<3)return this.getStreetView(e,i+1);{let i;!1===a&&(o=!0);try{i=await this._getAreaCode(t)}catch(s){return this.getStreetView(e)}return{panorama:t,roundInfo:r||null,area:i,warning:o}}}getRandomLatLng(){if(null!=this.placeGeoJson){let e,t,i=null;if("FeatureCollection"===this.placeGeoJson.type){let r=Math.floor(Math.random()*this.placeGeoJson.features.length);const a=this.placeGeoJson.features[r];i=a.properties,"Point"===a.geometry.type?(e=a.geometry.coordinates,t=50):(t=100*(0,l.CX)((0,he.Z)(a)),e=ye()(a))}else t=100*(0,l.CX)((0,he.Z)(this.placeGeoJson)),e=ye()(this.placeGeoJson);return{radius:t,position:new google.maps.LatLng(e[1],e[0]),properties:i}}const e=170*Math.random()-85,t=360*Math.random()-180;return{radius:1e5,position:new google.maps.LatLng(e,t),properties:null}}_checkStreetView(e){return!(this.settingsPanorama.optimiseStreetView&&(!/^\xA9 (?:\d+ )?Google$/.test(e.copyright)||!e.imageDate||e.links.length<2||Array.isArray(e.g)&&0!==e.g.length))}async _getAreaCode(e){if([u.wz.COUNTRY,u.wz.CUSTOM_AREA].includes(this.settingsGame.mode)){if(this.settingsGame.mode===u.wz.COUNTRY||this.settingsGame.areaParams&&this.settingsGame.areaParams.data.type===u.Ho.NOMINATIM)return(0,l.Xp)(e.location.latLng,this.settingsGame.areaParams&&this.settingsGame.areaParams.data);{const t=this.settingsGame.areasJson.features.find((t=>(0,pe.Z)([e.location.latLng.lng(),e.location.latLng.lat()],t)));if(t){const e=this.settingsGame.areaParams?this.settingsGame.areaParams.data.pathKey:"iso_a2";return t.properties[e]}throw new Error("Area not found")}}}}var we=ve,be={data(){return{canExit:!1}},methods:{beforeUnload(e){e.returnValue=this.$t("StreetView.confirmExit")}},created(){window.addEventListener("beforeunload",this.beforeUnload)},beforeRouteLeave(e,t,i){if(this.canExit)i();else{const e=window.confirm(this.$t("StreetView.confirmExit"));e?i():i(!1)}},beforeDestroy(){window.removeEventListener("beforeunload",this.beforeUnload)}},Se={components:{HeaderGame:v,Maps:oe,DialogMessage:ce},mixins:[be],props:{roomName:{default:null,type:String},allPanorama:{default:!1,type:Boolean},optimiseStreetView:{default:!0,type:Boolean},playerNumber:{default:null,type:Number},playerName:{default:null,type:String},placeGeoJson:{default:null,type:Object},multiplayer:{default:!1,type:Boolean},time:{default:0,type:Number},difficulty:{default:2e3,type:Number},bboxObj:{default:null,type:Array},roundsPredefined:{default:null,type:Array},modeSelected:{default:u.wz.CLASSIC,type:String},panControl:{default:!0,type:Boolean},zoomControl:{default:!0,type:Boolean},moveControl:{default:!0,type:Boolean},timeAttackSelected:{default:!1,type:Boolean},countdown:{default:0,type:Number},scoreMode:{default:u.se.NORMAL,type:String},areaParams:{type:Object},mapDetails:{type:Object,required:!1,default:void 0},nbRoundSelected:{type:Number,required:!1,default:5}},data(){return{area:null,randomLatLng:null,randomFeatureProperties:null,score:0,scoreHeader:0,points:0,pointsHeader:0,round:1,timeLimitation:this.time,mode:this.modeSelected,timeAttack:this.timeAttackSelected,nbRound:this.timeAttackSelected?10:this.nbRoundSelected,remainingTime:0,endTime:null,hasTimerStarted:!1,hasLocationSelected:!1,overlay:!1,room:null,isReady:!1,dialogMessage:this.multiplayer,dialogTitle:this.$t("StreetView.waitForOtherPlayers"),dialogText:"",isVisibleDialog:!1,panorama:null,difficultyData:this.difficulty,bbox:this.bboxObj,isVisibleCountdownAlert:!1,timeCountdown:0,streetViewService:null}},computed:{...(0,m.Se)(["areasJson"]),countdownPercentage(){return 100*this.remainingTime/this.timeCountdown}},async mounted(){(this.areaParams&&this.areaParams.data.urlArea||this.mode===u.wz.COUNTRY)&&await this.loadAreas(this.areaParams&&this.areaParams.data.urlArea),await this.$gmapApiPromiseLazy(),this.panorama=new google.maps.StreetViewPanorama(this.$refs.streetView),this.streetViewService||(this.streetViewService=new we({allPanorama:this.allPanorama,optimiseStreetView:this.optimiseStreetView},{mode:this.mode,areaParams:this.areaParams,areasJson:this.areasJson},this.placeGeoJson,this.roundsPredefined)),this.multiplayer?(this.roomName||this.exitGame(),this.room=o.Z.database().ref(this.roomName),1===this.playerNumber&&await this.loadStreetView(),this.room.child("active").set(!0),this.room.on("value",(e=>{if(e.hasChild("active")){if(!e.child("round"+this.round).hasChild("player"+this.playerNumber)&&(this.room.child("round"+this.round).child("player"+this.playerNumber).set(0),1!=this.playerNumber)){let t=e.child("streetView/round"+this.round+"/latitude").val(),i=e.child("streetView/round"+this.round+"/longitude").val();this.area=e.child("streetView/round"+this.round+"/area").val(),this.isVisibleDialog=e.child("streetView/round"+this.round+"/warning").val(),this.randomFeatureProperties=e.child("streetView/round"+this.round+"/roundInfo").val(),this.randomLatLng=new google.maps.LatLng(t,i),this.resetLocation()}e.child("round"+this.round).numChildren()!==e.child("size").val()||this.isReady||(this.dialogMessage=!1,this.dialogText="",this.isReady=!0,this.$refs.mapContainer.startNextRound(),this.timeLimitation=e.child("timeLimitation").val(),0!=this.timeLimitation&&(this.hasTimerStarted||(this.initTimer(this.timeLimitation),this.hasTimerStarted=!0))),e.child("isGameDone").numChildren()==e.child("size").val()&&(this.room.child("active").remove(),this.room.off(),this.room.remove())}else this.exitGame()}))):(await this.loadStreetView(),this.$refs.mapContainer.startNextRound(),0!=this.timeLimitation&&(this.hasTimerStarted||(this.initTimer(this.timeLimitation),this.hasTimerStarted=!0))),this.$refs.header.startTimer()},beforeDestroy(){document.querySelector(".widget-scene")&&(document.querySelector(".widget-scene").removeEventListener("keydown",this.onUserEventPanoramaKey),document.querySelector(".widget-scene").removeEventListener("mousedown",this.onUserEventPanoramaMouse)),window.removeEventListener("beforeunload",this.beforeUnload),this.room&&(this.room.child("active").remove(),this.room.off())},methods:{...(0,m.nv)(["loadAreas"]),async loadStreetView(){let{panorama:e,roundInfo:t,warning:i,area:r}=await this.streetViewService.getStreetView(this.round);this.randomLatLng=e.location.latLng,this.randomFeatureProperties=t,this.area=r,this.setPosition(e),this.multiplayer&&this.room.child("streetView/round"+this.round).set({latitude:this.randomLatLng.lat(),longitude:this.randomLatLng.lng(),roundInfo:t,...r&&{area:r},warning:i})},resetLocation(){const e=new google.maps.StreetViewService;e.getPanorama({location:this.randomLatLng,preference:"nearest",radius:50,source:this.allPanorama?"default":"outdoor"},this.setPosition)},setPosition(e){this.panorama.setOptions({addressControl:!1,fullscreenControl:!1,motionTracking:!1,motionTrackingControl:!1,showRoadLabels:!1,panControl:this.panControl,zoomControl:this.zoomControl,scrollwheel:this.zoomControl,disableDoubleClickZoom:!this.zoomControl,linksControl:this.moveControl,clickToGo:this.moveControl}),document.querySelector('#street-view a[href^="https://maps"]')&&document.querySelector('#street-view a[href^="https://maps"]').remove(),setTimeout((()=>{document.querySelector(".widget-scene")&&(document.querySelector(".widget-scene").addEventListener("keydown",this.onUserEventPanoramaKey),document.querySelector(".widget-scene").addEventListener("mousedown",this.onUserEventPanoramaMouse),document.querySelector(".widget-scene").addEventListener("touchstart",this.onUserEventPanoramaMouse),document.querySelector(".widget-scene").addEventListener("pointerdown",this.onUserEventPanoramaMouse))}),50),e&&e.location&&this.panorama.setPano(e.location.pano),this.panorama.setPov({heading:270,pitch:0}),this.panorama.setZoom(0)},initTimer(e,t){const i=new Date;i.setSeconds(i.getSeconds()+e),t&&(this.timeCountdown=e,this.isVisibleCountdownAlert=!0),this.hasTimerStarted?this.endTime=this.endTime>i?i:this.endTime:(this.endTime=i,this.startTimer())},startTimer(e=this.round){e===this.round&&(this.remainingTime=Math.max(0,Math.round((this.endTime-Date.now())/1e3)),this.remainingTime>0?setTimeout((()=>{this.startTimer(e)}),1e3):(this.timerInProgress=!1,this.hasLocationSelected||([u.wz.COUNTRY,u.wz.CUSTOM_AREA].includes(this.mode)?this.$refs.mapContainer.selectRandomLocation((0,l.j8)(this.areasJson,this.areaParams?this.areaParams.data.pathKey:"iso_a2")):this.$refs.mapContainer.selectRandomLocation(this.streetViewService.getRandomLatLng().position))))},updateScore(e,t){this.hasLocationSelected=!0,this.multiplayer||(this.remainingTime=0),this.score+=e,this.points+=t,this.multiplayer&&(this.room.child("finalScore/player"+this.playerNumber).set(this.score),this.room.child("finalPoints/player"+this.playerNumber).set(this.points),this.dialogTitle=this.$t("StreetView.waitForOtherPlayers"),this.dialogMessage=!0)},showResult(){this.scoreHeader=this.score,this.pointsHeader=this.points,this.remainingTime=0,this.dialogMessage=!1,this.isVisibleCountdownAlert=!1,this.overlay=!0,this.$refs.header.stopTimer()},async goToNextRound(e=!1){e&&(this.round=0,this.scoreHeader=0,this.pointsHeader=0,this.score=0,this.points=0),this.randomLatLng=null,this.area=null,this.overlay=!1,this.hasTimerStarted=!1,this.hasLocationSelected=!1,this.isVisibleDialog=!1,this.randomFeatureProperties=null,this.multiplayer&&(this.dialogMessage=!0,this.isReady=!1),this.round+=1,1!=this.playerNumber&&this.multiplayer?this.room.child("trigger/player"+this.playerNumber).set(this.round):(await this.loadStreetView(),this.multiplayer||0==this.timeLimitation||this.initTimer(this.timeLimitation)),this.$refs.mapContainer.startNextRound()},exitGame(){this.dialogTitle=this.$t("StreetView.redirectToHomePage"),this.dialogText=this.$t("StreetView.exitGame"),this.dialogMessage=!0,this.canExit=!0,this.room?(this.room.off(),this.room.remove(),this.$router.push("/history")):this.$router.push("/")},finishGame(){this.canExit=!0,this.multiplayer?(this.dialogTitle=this.$t("StreetView.waitForOtherPlayersToFinish"),this.dialogText="",this.dialogMessage=!0):this.$router.push("/history")},onUserEventPanoramaKey(e){(!this.moveControl&&[38,40,87,83,90].includes(e.keyCode)||!this.zoomControl&&[107,109,187,189].includes(e.keyCode)||!this.panControl&&[37,39,65,68,100,102].includes(e.keyCode))&&e.stopPropagation()},onUserEventPanoramaMouse(e){this.panControl||e.stopPropagation()}}},Pe=Se,Ce=i(8468),xe=i(802),ke=i(7024),Me=i(2113),_e=(0,h.Z)(Pe,r,a,!1,null,"d9d9e128",null),Le=_e.exports;g()(_e,{VAlert:Ce.Z,VBtn:k.Z,VIcon:N.Z,VOverlay:xe.Z,VProgressLinear:ke.Z,VTooltip:Me.Z})}}]);
//# sourceMappingURL=431.27d49392.js.map